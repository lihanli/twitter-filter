(function(){var CONVERSATION_CHILDREN,RCLASS,Tweet,filterCurrentPage,filterTweets,filteredPhrases,filteredUsers,hasClass,options,pageWatcher,setupPage;RCLASS=/[\n\t]/g,CONVERSATION_CHILDREN=[".missing-tweets-bar",".conversation-header"],filteredUsers=null,filteredPhrases=null,options=null,Tweet=function(){function Tweet($el){this.screenName=$el.data("screen-name"),this.text=$el.find(".tweet-text").text()}return Tweet.prototype.userData=function(){return _.pick(this,"screenName")},Tweet.prototype.shouldHide=function(){var allFilteredPhrases,lowercaseText;return lowercaseText=this.text.toLowerCase(),allFilteredPhrases=filteredPhrases.map(function(filteredPhrase){return filteredPhrase.get("phrase")}),options.get("hideMentions")&&filteredUsers.each(function(filteredUser){return allFilteredPhrases.push("@"+filteredUser.get("screenName"))}),this.hidden=function(){var phrase,_i,_len;if(filteredUsers.findByScreenName(this.screenName))return!0;for(_i=0,_len=allFilteredPhrases.length;_len>_i;_i++)if(phrase=allFilteredPhrases[_i],-1!==lowercaseText.indexOf(phrase))return!0;return!1}.apply(this,arguments)},Tweet.getCachedTweet=function($el){return $el.data("tf-tweet")},Tweet}(),hasClass=function(el,selector){var className;return className=" "+selector+" ",(" "+el.className+" ").replace(RCLASS," ").indexOf(className)>-1?!0:!1},filterCurrentPage=function(){return filterTweets(document.querySelectorAll(".stream-items li"))},filterTweets=function(els){var $els,hideCompletely,removeConversationModule,toHide;return $els=$(els),toHide=[],hideCompletely=options.get("hideCompletely"),removeConversationModule=function($el){var module;return module=$el.parents("ol.conversation-module"),0!==module.length?(module.removeClass("conversation-module"),_.each(CONVERSATION_CHILDREN,function(klass){return module.find(klass).hide()})):void 0},_.each(CONVERSATION_CHILDREN,function(klass){return $els.find(klass).show()}),$els.parents("ol[data-ancestors]").addClass("conversation-module"),$els.find(".tweet").each(function(){var $this,tweet;return $this=$(this),tweet=new Tweet($this),$this.data("tf-tweet",tweet),$this.show(),$this.find(".content").show(),$this.find(".tf-el").remove(),tweet.shouldHide()&&toHide.push({$el:$this}),$this.find(".account-group").after('<a class="toggle-hide tf-el">\n  '+(tweet.hidden?"Unhide":"Hide")+"\n</a>")}),_.each(toHide,function(hideObj){var $el,replacement,tweet;return $el=hideObj.$el,tweet=Tweet.getCachedTweet($el),hideCompletely?($el.hide(),removeConversationModule($el)):($el=$el.find(".content"),replacement=$('<div class="hidden-message tf-el">\n  '+_.escape(tweet.screenName)+"'s tweet has been filtered. <a>Show?</a>\n</div>"),replacement.find("a").click(function(){return $el.show(),replacement.remove()}),$el.hide().after(replacement))})},chrome.extension.sendMessage({options:null},function(res){var filteredPhrasesDeferred,filteredUsersDeferred;return options=new models.Options(res.options),options.get("enable")?(pageWatcher(),filteredUsersDeferred=$.Deferred(),filteredPhrasesDeferred=$.Deferred(),chrome.extension.sendMessage({filteredUsers:null},function(res){return filteredUsers=models.generateCollection({collectionName:"FilteredUsers",data:res.filteredUsers,anyChangeCb:function(){return filterCurrentPage()}}),filteredUsersDeferred.resolve()}),chrome.extension.sendMessage({filteredPhrases:null},function(res){return filteredPhrases=models.generateCollection({collectionName:"FilteredPhrases",data:res.filteredPhrases}),filteredPhrasesDeferred.resolve()}),$.when(filteredUsersDeferred,filteredPhrasesDeferred).then(function(){return setupPage()})):void 0}),pageWatcher=function(){var oldLocation;return oldLocation=location.href,setInterval(function(){var newLocation;return newLocation=location.href,newLocation!==oldLocation?(oldLocation=newLocation,setupPage()):void 0},500)},setupPage=function(){var addClickHandlers,addObserver,observer;return observer=null,addObserver=function(){return observer&&observer.disconnect(),observer=new MutationObserver(function(mutations){return mutations.forEach(function(mutation){var addedNodes,firstAdded;return addedNodes=mutation.addedNodes,firstAdded=addedNodes[0],addedNodes.length>0&&(hasClass(firstAdded,"stream-item")||hasClass(firstAdded,"conversation-tweet-item")||"LI"===firstAdded.tagName&&firstAdded.children.length>0&&hasClass(firstAdded.children[0],"tweet"))?filterTweets(addedNodes):void 0})}),observer.observe(document.querySelector(".stream-items"),{childList:!0,subtree:!0})},addClickHandlers=function(){return $(".stream-container").on("click",".tweet .toggle-hide",function(){var filteredUser,tweet;return tweet=Tweet.getCachedTweet($(this).parents(".tweet")),tweet.hidden?filteredUsers.remove(filteredUsers.findByScreenName(tweet.screenName)):confirm("Hide all of "+tweet.screenName+"'s tweets? This won't unfollow or block him/her.")?(filteredUser=models.generateModelWithSanitizer({Model:models.FilteredUser,attr:"screenName"}),filteredUser.set(tweet.userData()),filteredUsers.add(filteredUser)):void 0})},function(){var path;return path=location.pathname,"/mentions"!==path&&"/i/connect"!==path?(addObserver(),addClickHandlers(),filterCurrentPage()):void 0}}()}).call(this);